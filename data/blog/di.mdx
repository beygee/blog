---
title: 'DI êµ¬í˜„'
date: '2022-03-22'
tags: ['di']
draft: true
---

# Overviews

í´ë˜ìŠ¤ê°„ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê¸° ìœ„í•´ DI íŒ¨í„´ì„ ì´ìš©í•©ë‹ˆë‹¤.

ë¨¼ì € ì˜ˆë¥¼ ë“¤ê¸° ìœ„í•´ ê²Œì„ ì„¸ê³„ì˜ í”Œë ˆì´ì–´ê°€ ë¬´ê¸°ë¥¼ ì´ìš©í•˜ëŠ” í´ë˜ìŠ¤ êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

```ts showLineNumbers
interface Weapon {
  use: () => void
}

class Sword implements Weapon {
  use() {
    console.log('SWORD!!')
  }
}

class Player {
  private readonly weapon: Weapon
  constructor(weapon: Weapon) {
    this.weapon = weapon
  }

  handle() {
    this.weapon.use()
  }
}

const player = new Player(new Sword())
player.handle() // SWORD!!!
```

ìœ„ì˜ ì˜ˆì œë¥¼ ë³´ë©´ í”Œë ˆì´ì–´ëŠ” ì–´ë–¤ Weapon íƒ€ì…ì˜ ë¬´ê¸°ë¥¼ ì†Œì§€í•  ìˆ˜ ìˆê³ , ì´ë¥¼ handleí•˜ì—¬ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. handle ì•ˆì— `weapon.use` í•¨ìˆ˜ë¥¼ í†µí•´ ë¬´ê¸°ë¥¼ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ì§€ëŠ” Weaponì˜ ì±…ì„ì— ì „ê°€í•©ë‹ˆë‹¤.

ê²Œì„ì„ ë§Œë“¤ë‹¤ë³´ë©´ í”Œë ˆì´ì–´ëŠ” ë‹¤ì–‘í•œ í˜•íƒœë¡œ ì „ì§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì „ì‚¬ë¡œ ì „ì§í•˜ë©´ ê²€ í˜•íƒœì˜ ë¬´ê¸°ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê² ì£ . ë˜ ìŠ¤ë‚˜ì´í¼ë¡œ ì „ì§í•˜ë©´ ì´ì„ ì´ìš©í•  ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤ ğŸ˜€

```ts showLineNumbers
interface Weapon {
  use: () => void
}

class Sword implements Weapon {
  use() {
    console.log('SWORD!!')
  }
}

class Gun implements Weapon {
  use() {
    console.log('FIRE GUN!!')
  }
}

class Player {
  private readonly weapon: Weapon
  constructor(weapon: Weapon) {
    this.weapon = weapon
  }

  handle() {
    this.weapon.use()
  }
}

class Warrior extends Player {
  constructor(sword: Sword) {
    super(sword)
  }
}

class Sniper extends Player {
  constructor(gun: Gun) {
    super(gun)
  }
}

const warrior = new Warrior(new Sword())
warrior.handle()

const sniper = new Sniper(new Gun())
sniper.handle()
```

ìœ„ì˜ ì˜ˆì œì²˜ëŸ¼ ì „ì‚¬ëŠ” ê²€ì„ ì†Œì§€í•˜ì—¬ ì´ìš©í•˜ê³ , ìŠ¤ë‚˜ì´í¼ëŠ” ì´ì„ ì†Œì§€í•˜ì—¬ ì´ìš©í•©ë‹ˆë‹¤. ì˜ì¡´ì„±ì„ ìƒì„±ìì— ì£¼ì…í•¨ìœ¼ë¡œì¨ ì–´ë–¤ ë¬´ê¸°ë¥¼ ì‚¬ìš©í• ì§€ ê²°ì •í•©ë‹ˆë‹¤.

ì—¬ê¸°ì— IOC ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ ì‹±ê¸€í†¤ í˜•íƒœë¡œ ìƒì„±ìì— í´ë˜ìŠ¤ë¥¼ ìë™ì£¼ì…í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¨¼ì € ì»¨í…Œì´ë„ˆë¥¼ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.

```ts:container.ts showLineNumbers
type ClassType = new () => {}
class Container {
  metadata: { [key: string]: ClassType } = {}
}
export const GlobalContainer = new Container()
```

ContainerëŠ” metadataë¡œ key:value í˜•íƒœì˜ í´ë˜ìŠ¤ íƒ€ì…ì„ ì €ì¥í•©ë‹ˆë‹¤.
`GlobalContainer`ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ ì™¸ë¶€ë¡œ export í•©ë‹ˆë‹¤.

ì´í›„ `Injectable` í´ë˜ìŠ¤ ë°ì½”ë ˆì´í„°ë¥¼ ë§Œë“¤ì–´, ì´ë¥¼ ì‚¬ìš©í•œ í´ë˜ìŠ¤ëŠ” GlobalContainer metadataì— ë‹´ì•„ë‘ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```ts:decorator.ts showLineNumbers
import { GlobalContainer } from './container'

export function Injectable<T extends { new (...args: any[]): {} }>(constructor: T) {
  GlobalContainer.metadata[constructor.name] = constructor
}
```

ì´í›„ì— Gun í´ë˜ìŠ¤ì™€ Sword í´ë˜ìŠ¤ ìœ„ì— Injectable ë°ì½”ë ˆì´í„°ë¥¼ ì„ ì–¸í•´ì¤ë‹ˆë‹¤.

```ts:index.ts {1,8} showLineNumbers
@Injectable
class Sword implements Weapon {
  use() {
    console.log('SWORD!!')
  }
}

@Injectable
class Gun implements Weapon {
  use() {
    console.log('FIRE GUN!!')
  }
}
```
