---
title: 'í”ŒëŸ¬í„° GraphQL Codegení›„ freezed ì—°ë™í•˜ê¸°'
date: '2022-02-16'
tags: ['flutter', 'graphql', 'artemis', 'freezed']
draft: false
---

# Overviews

í”ŒëŸ¬í„°ë¡œ ê°œë°œí•˜ë©´ì„œ API ì—°ê²°ì— ìƒë‹¹ë¶€ë¶„ ì½”ë“œë¥¼ ì‘ì„±í•˜ê²Œ ë©ë‹ˆë‹¤.

[Bloc í˜ì´ì§€](https://bloclibrary.dev/#/architecture)ì— ë‚˜ì™€ìˆëŠ” ì•„í‚¤í…ì²˜ì— ë”°ë¥´ë©´ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ì‘ì„±í•˜ëŠ” ì½”ë“œ ì•„í‚¤í…ì²˜ëŠ”

![](/static/images/blog/flutter-graphql-codegen-freezed/1.png)

- Presentation
- Business Logic
- Data
  - Repository
  - DataProvider

êµ¬ì„±ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

`Data` ì˜ì—­ì€ ìš°ë¦¬ê°€ ì„œë¹„ìŠ¤ì— ì´ìš©í•  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ ì „ë‹¬í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
í¬ê²Œ Repository, DataProvider ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`DataProvider`ëŠ” ì„œë²„ ë˜ëŠ” ë¡œì»¬ DBë¡œë¶€í„° Raw Data(ë˜ëŠ” JSON) í˜•íƒœì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

`Repository`ëŠ” DataProviderì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ í† ëŒ€ë¡œ ìš°ë¦¬ê°€ ëª¨ë¸ë§í•œ ê°ì²´ë¡œ íŒŒì‹±í•˜ëŠ” ì‘ì—…ì„ ê±°ì¹©ë‹ˆë‹¤.

`Business Logic`ì€ í™”ë©´ì„ ë³´ì—¬ì£¼ê¸° ì „ì— ë°ì´í„°ë¥¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì— ë§ê²Œ ì¬ê°€ê³µí•˜ê±°ë‚˜, ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë°›ì•„ ì ì ˆí•œ ì²˜ë¦¬ë¥¼ í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ í•©ë‹ˆë‹¤.

ì˜¤ëŠ˜ì€ Data ì˜ì—­ì—ì„œ Graphqlì„ ì´ìš©í•˜ì—¬ ì–´ë–»ê²Œ ê°€ê³µí•˜ëŠ”ì§€ë¥¼ ì•Œì•„ë³¼ ì˜ˆì •ì´ê¸° ë•Œë¬¸ì— Business Logicê³¼ Presentationì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ Bloc í˜ì´ì§€ì—ì„œ ì°¾ì•„ë³´ê±°ë‚˜ ê²€ìƒ‰ì„ í•´ë³¼ ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

# ëª©í‘œ

ìš°ë¦¬ì˜ ëª©í‘œëŠ” ë¶ˆí•„ìš”í•œ ì½”ë“œ íƒ€ì´í•‘ì„ ì¤„ì´ëŠ” ê²ƒì…ë‹ˆë‹¤.

1. graphql ì¿¼ë¦¬ë§Œ ì‘ì„±í•˜ë©´ ì•Œì•„ì„œ ì¿¼ë¦¬ dart íŒŒì¼ì„ ìƒì„±í•œë‹¤.
2. ìƒì„±ëœ dart íŒŒì¼ì„ í†µí•´ ê°ì²´ë¥¼ ë˜í•‘, ìƒì„±í•œë‹¤.
3. ëª¨ë¸ì— freezedë¥¼ ì—°ë™í•˜ì—¬ ê°ì¢… ìœ í‹¸ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆê²Œ í•œë‹¤.

# GraphQL ì—°ê²°

`artemis` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ë ¤ë©´ graphql ìŠ¤í‚¤ë§ˆê°€ í•„ìš”í•©ë‹ˆë‹¤. ì•„ì§ endpoint í˜•íƒœë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„, ì„œë²„ì—ì„œ ì œê³µí•´ì£¼ëŠ” graphql ìŠ¤í‚¤ë§ˆë¥¼ íŒŒì¼ë¡œ ë§Œë“œëŠ” ì„ í–‰ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ìŠ¤í‚¤ë§ˆë¥¼ JSON ë˜ëŠ” GRAPHQL í˜•íƒœë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” JS ìƒíƒœê³„ì— ë§ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í”ŒëŸ¬í„° í”„ë¡œì íŠ¸ì— JS ì‹¤í–‰í™˜ê²½ì„ ë§Œë“¤ì–´ì•¼í•©ë‹ˆë‹¤.

[GraphQL Code Generator](https://www.graphql-code-generator.com/) ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ì—¬ ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ ìŠ¤í‚¤ë§ˆë¥¼ íŒŒì¼ë¡œ ë§Œë“œëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.

GraphqL ì„œë²„ëŠ” JSONPlaceholderì˜ graphql ë²„ì „ì¸ [GraphQLZero](https://graphqlzero.almansi.me/)ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

flutter í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œì—ì„œ ë‹¤ìŒì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

```shell
$ npm init -y
$ npm i graphql @graphql-codegen/cli @graphql-codegen/schema-ast
```

ìœ„ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ `node_moudules` í´ë”ê°€ ìƒì„±ë©ë‹ˆë‹¤. `.gitignore`ì— í•´ë‹¹ í´ë”ë¥¼ ì¶”ê°€í•´ì£¼ì–´ ê¹ƒì—ì„œ ì œì™¸ì‹œí‚µë‹ˆë‹¤.

```shell:.gitignore {7}
...
# Android Studio will place build artifacts here
/android/app/debug
/android/app/profile
/android/app/release

node_modules # ì¶”ê°€
```

ê·¸ë¦¬ê³  ë£¨íŠ¸ ê²½ë¡œì— `codegen.yml` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

```yml:codegen.yml {} showLineNumbers
overwrite: true
schema: 'https://graphqlzero.almansi.me/api'
generates:
  ./lib/schema.graphql:
    plugins:
      - schema-ast
```

ìœ„ëŠ” `https://graphqlzero.almansi.me/api` ì—”ë“œí¬ì¸íŠ¸ì˜ graphql ìŠ¤í‚¤ë§ˆë¥¼ í™•ì¸í•˜ì—¬ `schema.graphql` íŒŒì¼ì„ ë§Œë“¤ê² ë‹¤ëŠ” ì„¤ì •ì…ë‹ˆë‹¤.

ì´í›„ `package.json` ìŠ¤í¬ë¦½íŠ¸ì— ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```json:package.json {2}
"scripts": {
  "codegen": "graphql-codegen --config codegen.yml"
},
```

ë§ˆì§€ë§‰ìœ¼ë¡œ í„°ë¯¸ë„ì—ì„œ `npm run codegen`ì„ ì…ë ¥í•˜ë©´ ì„±ê³µì ìœ¼ë¡œ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì´ ì¶”ê°€ë©ë‹ˆë‹¤.

![](/static/images/blog/flutter-graphql-codegen-freezed/2.png)

# Artemis

ì´ì œ Flutter ì§„ì˜ìœ¼ë¡œ ëŒì•„ì˜µë‹ˆë‹¤. ìƒì„±ëœ ìŠ¤í‚¤ë§ˆë¥¼ ê¸°ë°˜ìœ¼ë¡œ dart íŒŒì¼ì„ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.

ë¨¼ì € `pubspec.yaml`ì— ì˜ì¡´ì„± ì„¤ì¹˜ë¥¼ í•©ë‹ˆë‹¤.

```yaml:pubspec.yaml {} showLineNumbers
# ...
dependencies:
  # ...
  graphql_flutter: ^5.0.2-beta.2
  json_serializable: ^6.1.4

dev_dependencies:
  # ...
  build_runner: ^2.1.7
  artemis: ^7.1.0-beta.0
  freezed: ^1.0.2
```

ë¨¼ì € artemis ì„¤ì •ì„ í•´ì£¼ì–´ì•¼í•©ë‹ˆë‹¤. ë£¨íŠ¸ ê²½ë¡œì— `build.yaml`ì„ ìƒì„±í•©ë‹ˆë‹¤.

```yaml:build.yaml
targets:
  $default:
    builders:
      artemis:
        options:
          schema_mapping:
            - schema: lib/schema.graphql
              queries_glob: lib/graphql/*.graphql
              output: lib/generated/graphql_api.dart
```

ê·¸ë¦¬ê³  user ì¿¼ë¦¬ë¥¼ í˜¸ì¶œí•˜ëŠ” graphqlì„ ì‘ì„±í•©ë‹ˆë‹¤.

```graphql:lib/graphql/user.graphql showLineNumbers
query user{
  user(id: 1) {
    id
    username
    email
    address {
      geo {
        lat
        lng
      }
    }
  }
}
```

ì´ì œ í„°ë¯¸ë„ì— `flutter pub run build_runner build` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ì¿¼ë¦¬ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” dart íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

# graphql_flutter

ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ì¿¼ë¦¬ íŒŒì¼ì´ ë§Œë“¤ì–´ì¡Œìœ¼ë‹ˆ, ì´ì œ ì‹¤ì œë¡œ ë„¤íŠ¸ì›Œí¬ì™€ ì—°ê²°í•´ì•¼í•©ë‹ˆë‹¤. `artemis` ì—ì„œë„ í†µì‹  APIê°€ ì¡´ì¬í•˜ì§€ë§Œ, ì‹¤ì œë¡œ í° í”„ë¡œì íŠ¸ì—ì„œëŠ” `graphql-flutter`ì˜ í’ë¶€í•œ ê¸°ëŠ¥ì„ ì´ìš©í•´ì•¼í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ í†µì‹  ë¶€ë¶„ì€ `graphql-flutter` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ êµ¬í˜„í•©ë‹ˆë‹¤.

```dart:lib/graphql_client.dart showLineNumbers
import 'package:graphql_flutter/graphql_flutter.dart';
import 'package:gql/src/ast/ast.dart';

class MyGraphQLClient {
  MyGraphQLClient() {
    _initClient();
  }

  static String hostUrl = "https://graphqlzero.almansi.me/api";

  final HttpLink _httpLink = HttpLink(hostUrl);

  late GraphQLClient _client;
  GraphQLClient get client => _client;

  Future<dynamic> query(
    DocumentNode document, {
    Map<String, dynamic>? data,
  }) async {
    var result = await _client.query(QueryOptions(
      document: document,
      variables: data ?? {},
    ));

    if (result.hasException) {
      var message = result.exception!.graphqlErrors.first.message;
      throw GraphQLError(message: message);
    }

    return result.data;
  }

  Future<dynamic> mutate(
    DocumentNode document, {
    Map<String, dynamic>? data,
  }) async {
    var result = await _client.mutate(MutationOptions(
      document: document,
      variables: data ?? {},
    ));

    if (result.hasException) {
      var message = result.exception!.graphqlErrors.first.message;
      throw GraphQLError(message: message);
    }

    return result.data;
  }

  void _initClient() async {
    _client = GraphQLClient(
      cache: GraphQLCache(),
      link: _httpLink,
      defaultPolicies: DefaultPolicies(
        query: Policies(
          fetch: FetchPolicy.noCache,
        ),
      ),
    );
  }
}

MyGraphQLClient graphQLClient = MyGraphQLClient();
```

ì´ `graphQLClient`ë¥¼ ì´ìš©í•˜ì—¬ ì•„ê¹Œ ìƒì„±í–ˆë˜ `user query`ë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```dart
var data = await graphQLClient.query(UserQuery().document);
print(data["user"]);

// Restarted application in 489ms.
// flutter: {id: 1, username: Bret, email: Sincere@april.biz, address: {geo: {lat: -37.3159, lng: 81.1496}}}
```

`print` ë˜ëŠ” ê°’ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```json showLineNumbers
{
  "user": {
    "id": "1",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "geo": {
        "lat": -37.3159,
        "lng": 81.1496
      }
    }
  }
}
```

ì´ëŸ°ì‹ìœ¼ë¡œ ë§ì´ì£ . í•˜ì§€ë§Œ ì € `data`ëŠ” `Map<String, dynamic>`í˜• ì´ì–´ì„œ íƒ€ì…ì¶”ë¡ ë„ ë˜ì§€ì•ŠìŠµë‹ˆë‹¤. ì´ë¥¼ ê°ì²´ë¡œ ë˜í•‘í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹˜ê² ìŠµë‹ˆë‹¤.

# freezed

Userë¥¼ ë˜í•‘í•  ëª¨ë¸ì„ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

```dart:lib/models/user.dart {} showLineNumbers
import 'package:freezed_annotation/freezed_annotation.dart';
import 'package:flutter/foundation.dart';

part 'user.freezed.dart';
part 'user.g.dart';

@freezed
class User with _$User {
  const User._();
  const factory User({
    required String id,
    required String username,
    required String email,
    required Address address,
  }) = _User;

  factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);
}

@freezed
class Address with _$Address {
  const Address._();
  const factory Address({
    required Geo geo,
  }) = _Address;

  factory Address.fromJson(Map<String, dynamic> json) =>
      _$AddressFromJson(json);
}

@freezed
class Geo with _$Geo {
  const Geo._();
  const factory Geo({
    required double lat,
    required double lng,
  }) = _Geo;

  factory Geo.fromJson(Map<String, dynamic> json) => _$GeoFromJson(json);
}
```

ê·¸ë¦¬ê³  `flutter pub run build_runner build` ëª…ë ¹ì–´ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ì—¬ `freezed` íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.

```dart
var data = await graphQLClient.query(UserQuery().document);
var user = User.fromJson(data["user"]);
print(user.username);
print(user.address);
print(user.toJson());
```

ì´ì œ Raw Dataë¥¼ íŒŒì‹±í•˜ì—¬ ê°ì²´í˜•íƒœë¡œ ì´ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤! [freezed](https://pub.dev/packages/freezed)ë¡œ ê°ì²´ë¥¼ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— copyWith, fromJson, toJson ë“± ë‹¤ì–‘í•œ ìœ í‹¸ ê¸°ëŠ¥ì„ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# ì •ë¦¬

Dataë¥¼ ê°€ì ¸ì˜¤ëŠ” DataProvider ì—­í• ì„ artemisê°€ ëŒ€ì‹ í•´ì£¼ê²Œ ë˜ë©´ì„œ graphqlë§Œ ì‹ ê²½ì“°ë©´ ê°œë°œí•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´í›„ì— ê°ì²´ë¥¼ freezedë¡œ íŒŒì‹±í•˜ëŠ” ë¶€ë¶„ì„ ë”°ë¡œ Repositoryë¥¼ ë§Œë“¤ì–´ ì´ìš©í•˜ë©´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê°œë°œì— ë” ì§‘ì¤‘ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´í›„ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ bloc íŒ¨í„´ì„ ì´ìš©í•˜ê±°ë‚˜, getxë¥¼ ì´ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

---

ë‹¤ë§Œ **ì•„ì‰¬ìš´ ì **ì´ ëª‡ê°€ì§€ ìˆìŠµë‹ˆë‹¤. ğŸ˜¢

artemisì—ì„œ graphql ì½”ë“œë¥¼ í† ëŒ€ë¡œ íŒŒì¼ì„ ì œë„ˆë ˆì´íŒ…í•  ë•Œ, ìŠ¤í‚¤ë§ˆë¥¼ ë¶„ì„í•˜ì—¬ freezedë¥¼ ì§€ì›í•˜ëŠ” ëª¨ë¸ì„ ë§Œë“¤ì–´ ì¤€ë‹¤ë©´ ì‹œê°„ì„ ë” ì ˆì•½í•  ìˆ˜ ìˆì—ˆì„ ê²ë‹ˆë‹¤.

ê·¸ë¦¬ê³  dartì—ì„œ `null safety`ê°€ ë„ì…ë˜ë©´ì„œ, freezed ëª¨ë¸ì„ ì‘ì„±í•  ë•Œ ê°ê°ì˜ ì†ì„± ê°’ì´ `required`ì¸ì§€, `nullable`ì¸ì§€ ì •í™•íˆ ë§ì¶°ì„œ ê°œë°œí•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, graphqlì—ì„œëŠ” `age` ì†ì„±ì´ ì—†ëŠ”ë°, freezed ëª¨ë¸ì— `required int age`ë¡œ ì„ ì–¸í•˜ë©´ ê·¸ëŒ€ë¡œ í”„ë¡œê·¸ë¨ì´ ì£½ìŠµë‹ˆë‹¤.. ğŸ˜…

ë˜í•œ ë¦¬ì•¡íŠ¸ì—ì„œ ì£¼ë¡œ ì“°ëŠ” í›… ë°©ì‹ì²˜ëŸ¼ Flutter ì§„ì˜ì—ì„œ GraphQL Queryë¥¼ ìœ„ì ¯ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°ì—ë„ í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤. ê¸€ë¡œë²Œ ìƒíƒœê´€ë¦¬ê°€ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ìœ„ ì˜ˆì œì—ì„œ í–ˆë˜ ê²ƒì²˜ëŸ¼ í•¨ìˆ˜ í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ blocì´ë“  providerì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì´ í¸í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

# References

- https://bloclibrary.dev/
- https://pub.dev/packages/artemis
- https://another-light.tistory.com/78
- https://medium.com/@v.ditsyak/ultimate-toolchain-to-work-with-graphql-in-flutter-13aef79c6484
- https://bartvwezel.nl/flutter/generating-models-for-a-graphql-endpoint-in-flutter/
- https://www.graphql-code-generator.com/
- https://graphqlzero.almansi.me
